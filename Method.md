## BlazePose：移动设备上的实时人体姿态追踪


**Valentin Bazarevsky, Ivan Grishchenko, Karthik Raveendran, Tyler Zhu, Fan Zhang, Matthias Grundmann**

**谷歌研究**

**1600 Amphitheatre Pkwy, Mountain View, CA 94043, USA**

**{valik, igrishchenko, krav, tylerzhu, zhafang, grundman}@google.com**


**摘要**

我们提出 BlazePose，一个轻量级卷积神经网络架构，用于人体姿态估计，专为在移动设备上进行实时推理而设计。在推理过程中，该网络可以为单个人生成 33 个身体关键点，并在 Pixel 2 手机上以超过 30 帧/秒的速度运行。这使得它特别适合实时用例，如健身追踪和手语识别。我们的主要贡献包括一种新颖的人体姿态追踪方案和一个轻量级人体姿态估计神经网络，该网络结合了热图和回归方法来预测关键点坐标。

**1. 简介**

从图像或视频中估计人体姿态在各种应用中起着核心作用，例如健康追踪、手语识别和手势控制。由于姿势的多样性、众多的自由度和遮挡，这项任务具有挑战性。最近的研究 [10][7] 在姿态估计方面取得了显著进展。常见的方法是为每个关节生成热图，并为每个坐标细化偏移量。虽然这种热图的选择可以以最小的开销扩展到多人，但它使得单人模型比适合在移动电话上进行实时推理的模型要大得多。在本文中，我们解决了这个特定的用例，并证明了模型的显著加速，而质量几乎没有下降。

与基于热图的技术相比，基于回归的方法虽然计算量较小且更具可扩展性，但它们试图预测平均坐标值，通常无法解决潜在的歧义。Newell 等人 [9] 已经证明，即使参数数量较少，堆叠沙漏架构也能显著提高预测质量。我们在工作中扩展了这个想法，并使用编码器-解码器网络架构来预测所有关节的热图，然后使用另一个编码器直接回归到所有关节的坐标。我们工作的关键见解是，热图分支可以在推理过程中丢弃，使其足够轻量级，可以在移动电话上运行。


**2. 模型架构和流程设计**

**2.1 推理流程**

在推理过程中，我们采用检测器-跟踪器设置（见图 1），它在各种任务（如手部关键点预测 [3] 和密集面部关键点预测 [6]）上都显示出出色的实时性能。我们的流程包括一个轻量级人体姿态检测器，后面跟着一个姿态跟踪器网络。跟踪器预测关键点坐标、当前帧中人是否存在以及当前帧的细化感兴趣区域。当跟踪器指示没有人存在时，我们在下一帧上重新运行检测器网络。

**2.2 人体检测器**

大多数现代目标检测解决方案依赖于非极大值抑制 (NMS) 算法作为其最后的后期处理步骤。这适用于自由度较少的刚性物体。但是，此算法在包括高度关节姿势（例如人类的姿势，例如挥手或拥抱）的场景中会失效。这是因为多个模糊的框满足 NMS 算法的交并比 (IoU) 阈值。

为了克服这个限制，我们专注于检测相对刚性的身体部位（如人脸或躯干）的边界框。我们观察到，在许多情况下，神经网络关于躯干位置的最强信号是人的脸（因为它具有高对比度特征并且外观变化较少）。为了使这样的人体检测器快速且轻量级，我们做出了一个强有力的假设（对于 AR 应用来说是有效的），即对于我们的单人用例，人的头部应该始终可见。因此，我们使用一个快速的设备上人脸检测器 [2] 作为人体检测器的代理。此人脸检测器预测额外的人体特定对齐参数：人的臀部中点、围绕整个人体的圆的大小以及倾斜度（连接两个肩部中点和臀部中点的线之间的角度）。

**2.3 拓扑结构**

我们通过采用 BlazeFace[2]、BlazePalm[3] 和 Coco[8] 使用的人体上 33 个点的超集，提出了一种新的拓扑结构。这使我们能够与相应的数据集和推理网络保持一致。

与 OpenPose[4] 和 Kinect[1] 拓扑结构相比，我们只在面部、手部和脚部使用最少数量的关键点来估计后续模型的感兴趣区域的旋转、大小和位置。我们使用的拓扑结构如图 3 所示。有关其他信息，请参阅附录 A。

**2.4 数据集**

与大多数使用热图检测关键点的现有姿态估计解决方案相比，我们的基于跟踪的解决方案需要初始姿态对齐。我们将数据集限制在整个人都可见或可以自信地注释臀部和肩部关键点的情况。为了确保模型支持数据集中不存在的严重遮挡，我们使用了大量的模拟遮挡增强。我们的训练数据集包含 60K 张图像，其中场景中有一个或几个人处于常见姿势，以及 25K 张图像，其中场景中有一个人在进行健身锻炼。所有这些图像都由人工注释。

**2.5 神经网络架构**

我们系统的姿态估计组件预测所有 33 个人体关键点的位置，并使用流程的第一阶段（第 2.1 节）提供的
人体对齐方案。

我们采用图 4 所示的组合热图、偏移和回归方法。我们仅在训练阶段使用热图和偏移损失，并在运行推理之前从模型中移除相应的输出层。因此，我们有效地使用热图来监督轻量级嵌入，然后由回归编码器网络利用该嵌入。这种方法部分受到 Newell 等人 [9] 的堆叠沙漏方法的启发，但在我们的例子中，我们堆叠了一个微型编码器-解码器基于热图的网络和一个后续的回归编码器网络。

我们积极利用网络所有阶段之间的跳跃连接来实现高级和低级特征之间的平衡。然而，回归编码器的梯度不会传播回经过热图训练的特征（注意图 4 中的梯度停止连接）。我们发现这不仅可以改善热图预测，还可以大幅提高坐标回归精度。

**2.6 对齐和遮挡增强**

相关的姿态先验是拟议解决方案的重要组成部分。在训练期间，我们在增强和数据准备时特意限制了角度、比例和位移的支持范围。这使我们能够降低网络容量，从而使网络更快，同时需要主机设备上的计算和能量资源更少。

根据检测阶段或前一帧的关键点，我们对齐人体，使臀部之间的点位于作为神经网络输入传递的方形图像的中心。我们将旋转估计为中臀部和中肩部点之间的线 L，并旋转图像，使 L 平行于 y 轴。估计比例，以便所有身体点都适合于围绕身体的外接方形边界框，如图 2 所示。除此之外，我们应用 10% 的比例和偏移增强，以确保跟踪器处理帧之间的身体运动和失真的对齐。

为了支持不可见点的预测，我们在训练期间模拟遮挡（填充各种颜色的随机矩形），并引入每个点的可见性分类器，该分类器指示特定点是否被遮挡以及位置预测是否被认为不准确。这允许即使在严重遮挡的情况下也能不断地跟踪一个人，例如仅上半身或当大部分人体不在场景中时，如图 5 所示。


**3. 实验**

为了评估我们模型的质量，我们选择了 OpenPose [4] 作为基线。为此，我们手动注释了两个内部数据集，每个数据集包含 1000 张图像，每张图像中有 1-2 个人。第一个数据集（称为 AR 数据集）包含各种各样的野外人体姿势，而第二个数据集仅包含瑜伽/健身姿势。为了保持一致性，我们只使用具有 17 个点的 MS Coco [8] 拓扑进行评估，这是 OpenPose 和 BlazePose 的共同子集。作为评估指标，我们使用容差为 20% 的正确点百分比 (PCK@0.2)（如果二维欧几里得误差小于对应人体躯干大小的 20%，则我们假设该点被正确检测到）。为了验证人类基线，我们要求两名注释者独立地重新注释 AR 数据集，并获得平均 PCK@0.2 为 97.2。

我们训练了两个具有不同容量的模型：BlazePose Full（6.9 MFlop，3.5M 参数）和 BlazePose Lite（2.7 MFlop，1.3M 参数）。虽然我们的模型在 AR 数据集上的性能略逊于 OpenPose 模型，但 BlazePose Full 在 Yoga/Fitness 用例中优于 OpenPose。同时，BlazePose 在单个中端手机 CPU 上的运行速度比 20 核桌面 CPU[5] 上的 OpenPose 快 25-75 倍，具体取决于请求的质量。


**4. 应用**

我们开发了这个新的、设备上的、单人特定的人体姿态估计模型，以实现各种性能要求高的用例，例如手语、瑜伽/健身追踪和 AR。此模型在移动 CPU 上以接近实时的方式工作，并且可以在移动 GPU 上加速到超实时延迟。由于其 33 个关键点拓扑与 BlazeFace[2] 和 BlazePalm[3] 一致，因此它可以作为后续手部姿势 [3] 和面部几何估计 [6] 模型的骨干。

我们的方法本身可以扩展到更多关键点、3D 支持和额外的关键点属性，因为它不基于热图/偏移图，因此不需要为每个新特征类型添加一个额外的全分辨率层。


**参考文献**
(略)

**附录 A. BlazePose 关键点名称**
(略)